<!DOCTYPE html>
<html lang="ca">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Exemples de Slider Accessible</title>
  <link rel="stylesheet" href="../style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f9f9f9;
      margin: 0;
      padding: 0;
    }
    main {
      padding: 2rem;
      max-width: 700px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 2rem;
    }
    .example {
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 1.5rem;
      margin-bottom: 2rem;
    }
    .example.correcte {
      border-left: 6px solid #388e3c;
      box-shadow: 0 2px 8px #388e3c22;
    }
    .example.incorrecte {
      border-left: 6px solid #d32f2f;
      box-shadow: 0 2px 8px #d32f2f22;
    }
    .example h2 {
      margin-top: 0;
    }
    .code-box {
      background: #f4f4f4;
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 1rem;
      margin-top: 1rem;
      font-family: monospace;
      font-size: 0.95rem;
      overflow-x: auto;
    }
    .slider-row {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-top: 1rem;
    }
    input[type="range"] {
      width: 200px;
      min-width: 24px;
      min-height: 24px;
      cursor: pointer;
    }
    /* Àrea d'acció mínima per als sliders 1-4 */
    input[type="range"]::-webkit-slider-thumb {
      min-width: 24px;
      min-height: 24px;
      cursor: pointer;
    }
    input[type="range"]::-moz-range-thumb {
      min-width: 24px;
      min-height: 24px;
      cursor: pointer;
    }
    input[type="range"]::-ms-thumb {
      min-width: 24px;
      min-height: 24px;
      cursor: pointer;
    }
    input[type="number"] {
      width: 60px;
      padding: 0.3rem;
      border-radius: 4px;
      border: 1px solid #bbb;
    }
    label {
      font-weight: bold;
      margin-bottom: 0.5rem;
      display: inline-block;
    }

/* CSS Document */

.rating-slider label {
  display: block;
}

.rating-slider {
  color: #005a9c;
  user-select: none;
}

.rating-slider svg {
  forced-color-adjust: auto;
  touch-action: pan-y;
}

.rating-slider svg .focus-ring {
  fill: currentcolor;
  stroke-width: 0;
  fill-opacity: 0;
}

.rating-slider svg .target {
  stroke-width: 2px;
  stroke: currentcolor;
  fill-opacity: 0;
}

.rating-slider svg .label {
  font-size: 90%;
  font-family: sans-serif;
  fill: currentcolor;
}

.rating-slider svg .description {
  font-size: 90%;
  fill: canvastext;
}

.rating-slider svg .current .target {
  fill: currentcolor;
  fill-opacity: 1;
}

.rating-slider svg .current .label {
  fill: white;
  font-weight: bold;
}

/* focus styling */

.rating-slider:focus,
.rating-slider:focus-visible {
  outline: none !important;
}

.rating-slider svg .focus {
  stroke-width: 0;
  stroke: currentcolor;
  fill-opacity: 0;
}

.rating-slider:focus svg .focus-ring {
  stroke-width: 2px;
  stroke: currentcolor;
}

@media (forced-colors: active) {
  .rating-slider svg .focus-ring {
    fill: buttontext;
  }

  .rating-slider svg .target {
    stroke: buttontext;
  }

  .rating-slider svg .label {
    fill: buttontext;
  }

  .rating-slider svg .description {
    fill: buttontext;
  }

  .rating-slider svg .current .target {
    fill: buttontext;
  }

  .rating-slider svg .current .label {
    fill: canvas;
  }

  /* focus styling */

  .rating-slider svg .focus {
    stroke: linktext;
  }

  .rating-slider:focus svg .focus-ring {
    stroke: linktext;
  }
}

    .custom-slider-thumb {
      position: absolute;
      left: 50%;
      top: 0;
      width: 24px;
      height: 24px;
      background: #1976d2;
      border-radius: 50%;
      transition: box-shadow 0.15s, border 0.15s;
      outline: none;
      border: 2px solid #fff;
      box-shadow: 0 2px 8px #0002;
    }
    #custom-slider1:focus .custom-slider-thumb,
    #custom-slider2:focus .custom-slider-thumb {
      border: 3px solid #ff9800;
      box-shadow: 0 0 0 4px #fff, 0 0 0 8px #ff9800;
    }
  </style>
</head>
<body>
  <header>
    <div class="header-left">
      <a class="btn-back" href="../inici.html" aria-label="Torna enrere">
        <i class="fas fa-arrow-left"></i>
      </a>
      <h1>Exemples de Slider</h1>
    </div>
    <nav>
      <ul class="nav-bar">
        <li><a href="../components/cards.html">Cards</a></li>
        <li><a href="../components/buttons.html">Botons</a></li>
        <li><a href="../components/events.html">Events</a></li>
        <li><a href="../components/llistes.html">Llistes</a></li>
        <li><a href="../components/slider.html">Slider</a></li>
        <li><a href="../components/carrousel.html">Carousel</a></li>
      </ul>
    </nav>
  </header>

  <main>
    <!-- Pas 1: Slider personalitzat sense ARIA (no accessible) -->
    <section class="example incorrecte">
      <h2>PAS 1: Slider personalitzat sense ARIA</h2>
      <div id="custom-slider1" tabindex="0" style="width:200px; height:24px; background:#eee; border-radius:12px; position:relative; outline:none;"
        onkeydown="customSliderKeydown(event, this, 'custom-slider1')"
        onclick="customSliderClick(event, this, 'custom-slider1')"
        onmousedown="customSliderStartDrag(event, this, 'custom-slider1')">
        <div id="custom-slider1-thumb" class="custom-slider-thumb"></div>
      </div>
      <span id="custom-slider1-value">50</span>
      <div class="code-box"><pre><code>&lt;div tabindex="0" style="width:200px; height:24px; background:#eee; border-radius:12px; position:relative;" onkeydown="customSliderKeydown(event, this, 'custom-slider1')" onclick="customSliderClick(event, this, 'custom-slider1')"&gt;
  &lt;div style="position:absolute; left:50%; top:0; width:24px; height:24px; background:#1976d2; border-radius:50%;"&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;span&gt;50&lt;/span&gt;
</code></pre></div>
      <p style="color:#d32f2f; margin-top:1rem;">No és accessible per a productes de suport ni teclat. No té cap atribut ARIA.</p>
    </section>

    <!-- Pas 2: Slider personalitzat amb ARIA -->
    <section class="example correcte">
      <h2>PAS 2: Slider personalitzat amb ARIA</h2>
      <div id="custom-slider2" tabindex="0" role="slider"
        aria-valuemin="0" aria-valuemax="100" aria-valuenow="50" aria-label="Volum"
        style="width:200px; height:24px; background:#eee; border-radius:12px; position:relative; outline:none;"
        onkeydown="customSliderKeydown(event, this, 'custom-slider2')"
        onclick="customSliderClick(event, this, 'custom-slider2')"
        onmousedown="customSliderStartDrag(event, this, 'custom-slider2')">
        <div id="custom-slider2-thumb" class="custom-slider-thumb"></div>
      </div>
      <span id="custom-slider2-value">50</span>
      <div class="code-box"><pre><code>&lt;div tabindex="0" role="slider"
  aria-valuemin="0" aria-valuemax="100" aria-valuenow="50" aria-label="Volum"
  style="width:200px; height:24px; background:#eee; border-radius:12px; position:relative;"
  onkeydown="customSliderKeydown(event, this, 'custom-slider2')" onclick="customSliderClick(event, this, 'custom-slider2')"&gt;
  &lt;div style="position:absolute; left:50%; top:0; width:24px; height:24px; background:#1976d2; border-radius:50%;"&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;span&gt;50&lt;/span&gt;
</code></pre></div>
      <p style="color:#388e3c; margin-top:1rem;">Ara el component és accessible per teclat i productes de suport gràcies als atributs ARIA.</p>
    </section>

    <!-- Pas 3: Slider natiu sense ARIA extra -->
    <section class="example correcte">
      <h2>PAS 3: Slider natiu sense ARIA extra</h2>
      <label for="slider3">Volum</label>
      <div class="slider-row">
        <input 
          id="slider3" 
          type="range" 
          min="0" 
          max="100" 
          value="50"
          style="min-width:24px; min-height:24px; cursor:pointer;"
          oninput="document.getElementById('slider3-value').textContent = this.value;"
        >
        <span id="slider3-value">50</span>
      </div>
      <div class="code-box"><pre><code>&lt;label for="slider3"&gt;Volum&lt;/label&gt;
&lt;input 
  id="slider3" 
  type="range" 
  min="0" 
  max="100" 
  value="50"
  oninput="document.getElementById('slider3-value').textContent = this.value;" 
&gt;
&lt;span id="slider3-value"&gt;50&lt;/span&gt;
</code></pre></div>
      <p style="color:#388e3c; margin-top:1rem;">L'element natiu <code>input[type=range]</code> ja és accessible. No cal afegir atributs ARIA.</p>
    </section>

    <!-- Pas 4: Slider natiu amb ARIA redundant (no necessari) -->
    <section class="example incorrecte">
      <h2>PAS 4: Slider natiu amb ARIA redundant</h2>
      <label for="slider4">Volum</label>
      <div class="slider-row">
        <input 
          id="slider4" 
          type="range" 
          min="0" 
          max="100" 
          value="50"
          aria-valuemin="0"
          aria-valuemax="100"
          aria-valuenow="50"
          aria-label="Volum"
          style="min-width:24px; min-height:24px; cursor:pointer;"
          oninput="document.getElementById('slider4-value').textContent = this.value; this.setAttribute('aria-valuenow', this.value);"
        >
        <span id="slider4-value">50</span>
      </div>
      <div class="code-box"><pre><code>&lt;label for="slider4"&gt;Volum&lt;/label&gt;
&lt;input 
  id="slider4" 
  type="range" 
  min="0" 
  max="100" 
  value="50"
  aria-valuemin="0"
  aria-valuemax="100"
  aria-valuenow="50"
  aria-label="Volum"
  oninput="document.getElementById('slider4-value').textContent = this.value; this.setAttribute('aria-valuenow', this.value);" 
&gt;
&lt;span id="slider4-value"&gt;50&lt;/span&gt;
</code></pre></div>
      <p style="color:#d32f2f; margin-top:1rem;">Els atributs ARIA són redundants i no aporten res als <code>input[type=range]</code> natius.</p>
    </section>

    <!-- Pas 5: Slider de valoració (complex personalitzat) -->
    <section class="example correcte">
      <h2>PAS 5: Slider de valoració (component personalitzat)</h2>
       <ul>
        <li>L'element que rep el focus el pemet controlar.</li>
        <li>Hi ha definits: aria-valuenow, aria-valuemin, aria-valuemax.</li>
        <li>aria-valuenow és el valor que rep com a variable, si volem posar el text va a aria-valuetext.</li>
        <li>aria-label o aria-labelledby</li>
      </ul>
      <div lang="en" id="id-rating-label" class="label">Rate your satisfaction with the service you received</div>

      <div lang="en" id="id-rating" class="rating-slider"
        role="slider"
        tabindex="0"
        aria-valuemin="0"
        aria-valuenow="0"
        aria-valuemax="10"
        aria-valuetext="Choose a rating from 1 to 10 where 10 is extremely satisfied"
        aria-labelledby="id-rating-label">
        <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="800" height="110">
    <rect class="focus-ring" x="23" y="2" width="54" height="90" rx="5"></rect>
    <g class="rating" data-value="1">
      <rect class="target" height="24" width="32" x="13" y="30"></rect>
      <text class="label" x="25" y="47">1</text>
      <text class="description" x="13" y="20">Extremely Unsatisfied</text>
    </g>
    <g class="rating" data-value="2">
      <rect class="target" height="24" width="32" x="45" y="30"></rect>
      <text class="label" x="58" y="47">2</text>
    </g>
    <g class="rating" data-value="3">
      <rect class="target" height="24" width="32" x="77" y="30"></rect>
      <text class="label" x="91" y="47">3</text>
    </g>
    <g class="rating" data-value="4">
      <rect class="target" height="24" width="32" x="109" y="30"></rect>
      <text class="label" x="121" y="47">4</text>
    </g>
    <g class="rating" data-value="5">
      <rect class="target" height="24" width="32" x="141" y="30"></rect>
      <text class="label" x="153" y="47">5</text>
    </g>
    <g class="rating" data-value="6">
      <rect class="target" height="24" width="32" x="173" y="30"></rect>
      <text class="label" x="185" y="47">6</text>
    </g>
    <g class="rating" data-value="7">
      <rect class="target" height="24" width="32" x="205" y="30"></rect>
      <text class="label" x="217" y="47">7</text>
    </g>
    <g class="rating" data-value="8">
      <rect class="target" height="24" width="32" x="237" y="30"></rect>
      <text class="label" x="249" y="47">8</text>
    </g>
    <g class="rating" data-value="9">
      <rect class="target" height="24" width="32" x="269" y="30"></rect>
      <text class="label" x="281" y="47">9</text>
     </g>
    <g class="rating" data-value="10">
      <rect class="target" height="24" width="32" x="301" y="30"></rect>
      <text class="label" x="310" y="47">10</text>
      <text class="description" x="208" y="20">Extremely Satisfied</text>
     </g>
  </svg>
      </div>
      <div class="code-box"><pre><code>&lt;div
  class="rating-slider"
  role="slider"
  tabindex="0"
  aria-valuemin="0"
  aria-valuenow="0"
  aria-valuemax="10"
  aria-valuetext="Choose a rating from 1 to 10 where 10 is extremely satisfied"
  aria-labelledby="id-rating-label"
&gt;
  &lt;svg&gt;...&lt;/svg&gt;
&lt;/div&gt;

// Funcions principals utilitzades:
class RatingSlider {
  constructor(domNode) { ... }
  moveSliderTo(value) { ... }
  onSliderKeydown(event) { ... }
  onTargetClick(event) { ... }
  setFocusRing(value) { ... }
  addTotalRectsToRatingLabel() { ... }
}

// Inicialització:
window.addEventListener('load', function () {
  var sliders = document.querySelectorAll('.rating-slider');
  for (let i = 0; i < sliders.length; i++) {
    new RatingSlider(sliders[i]);
  }
});
</code></pre></div>
    </section>
  </main>

  <script>
    // Sincronitza el valor del slider amb l'input numèric
    function syncSliderInput(value) {
      const input = document.getElementById('slider4-input');
      const slider = document.getElementById('slider4');
      input.value = value;
      slider.setAttribute('aria-valuenow', value);
    }
    // Sincronitza el valor de l'input numèric amb el slider
    function syncInputSlider(value) {
      const slider = document.getElementById('slider4');
      const input = document.getElementById('slider4-input');
      // Validació bàsica per evitar valors fora de rang
      let v = parseInt(value, 10);
      if (isNaN(v)) v = 0;
      if (v < 0) v = 0;
      if (v > 100) v = 100;
      slider.value = v;
      slider.setAttribute('aria-valuenow', v);
      input.value = v;
    }


    // Slider de valoració accessible
      'use strict';
/*
 *   This content is licensed according to the W3C Software License at
 *   https://www.w3.org/Consortium/Legal/2015/copyright-software-and-document
 *
 *   File:   slider-rating.js
 *
 *   Desc:   RatingSlider widget that implements ARIA Authoring Practices
 */

const SELECTED_SIZE = 6;
const RAIL_LEFT = 13;
const RAIL_TOP = 35;
const RAIL_HEIGHT = 24;

class RatingSlider {
  constructor(domNode) {
    this.sliderNode = domNode;

    this.isMoving = false;

    this.svgNode = domNode.querySelector('svg');
    this.focusRect = domNode.querySelector('.focus-ring');

    this.targetRects = Array.from(
      domNode.querySelectorAll('g.rating rect.target')
    );

    this.labelTexts = Array.from(
      domNode.querySelectorAll('g.rating text.label')
    );

    [this.targetInfo, this.railWidth] = this.calcRatingRects();
    this.infoDefaultFocusRect = this.calcDefaultFocusRect();

    this.valueMin = this.getValueMin();
    this.valueMax = this.getValueMax();

    this.sliderNode.addEventListener(
      'keydown',
      this.onSliderKeydown.bind(this)
    );

    this.labelTexts.forEach((lt) => {
      lt.addEventListener('click', this.onTargetClick.bind(this));
    });

    this.targetRects.forEach((tr) => {
      tr.addEventListener('click', this.onTargetClick.bind(this));
      tr.addEventListener('pointerdown', this.onSliderPointerDown.bind(this));
      tr.addEventListener('pointermove', this.onPointerMove.bind(this));
    });

    // bind a pointerup event handler to stop tracking pointer movements
    document.addEventListener('pointerup', this.onPointerUp.bind(this));

    this.addTotalRectsToRatingLabel();
    this.sliderNode.addEventListener(
      'blur',
      this.addTotalRectsToRatingLabel.bind(this)
    );

    window.addEventListener('resize', this.onResize.bind(this));

    this.setFocusRing(0);
  }

  getValue() {
    return parseFloat(this.sliderNode.getAttribute('aria-valuenow'));
  }

  getValueMin() {
    return parseFloat(this.sliderNode.getAttribute('aria-valuemin'));
  }

  getValueMax() {
    return parseFloat(this.sliderNode.getAttribute('aria-valuemax'));
  }

  getValueText(value) {
    switch (value) {
      case 0:
        return 'Choose a rating from one to ten where 10 is extremely satisfied';

      case 1:
        return 'one, extremely dissatisfied';

      case 2:
        return 'two';

      case 3:
        return 'three';

      case 4:
        return 'four';

      case 5:
        return 'five';

      case 6:
        return 'six';

      case 7:
        return 'seven';

      case 8:
        return 'eight';

      case 9:
        return 'nine';

      case 10:
        return 'ten, extremely satisfied';

      default:
        break;
    }

    return 'Unexpected value: ' + value;
  }

  getValueTextWithMax(value) {
    switch (value) {
      case 0:
        return 'Choose a rating from one to ten where 10 is extremely satisfied';

      case 1:
        return 'one out of 10, extremely dissatisfied';

      case 2:
        return 'two out of ten where ten is extremely satisfied';

      case 3:
        return 'three  out of ten where ten is extremely satisfied';

      case 4:
        return 'four  out of ten where ten is extremely satisfied';

      case 5:
        return 'five  out of ten where ten is extremely satisfied';

      case 6:
        return 'six  out of ten where ten is extremely satisfied';

      case 7:
        return 'seven  out of ten where ten is extremely satisfied';

      case 8:
        return 'eight  out of ten where ten is extremely satisfied';

      case 9:
        return 'nine  out of ten where ten is extremely satisfied';

      case 10:
        return 'ten  out of ten, extremely satisfied';

      default:
        break;
    }

    return 'Unexpected value: ' + value;
  }

  calcRatingRects() {
    let infoRatingRects = [];

    const railWidth = Math.min(
      Math.max(260, this.sliderNode.getBoundingClientRect().width),
      600
    );
    const rectWidth = Math.round((railWidth - RAIL_LEFT) / 10);

    let left = RAIL_LEFT;

    for (let i = 0; i < this.targetRects.length; i += 1) {
      const targetNode = this.targetRects[i];
      const labelNode = this.labelTexts[i];

      targetNode.setAttribute('x', left);
      targetNode.setAttribute('y', RAIL_TOP);
      targetNode.setAttribute('width', rectWidth);
      targetNode.setAttribute('height', RAIL_HEIGHT);
      targetNode.removeAttribute('rx');

      this.setLabelPosition(labelNode, left, rectWidth);

      const targetInfo = {
        x: left,
        y: RAIL_TOP,
        width: rectWidth,
        height: RAIL_HEIGHT,
        rx: 0,
      };

      infoRatingRects[i] = targetInfo;

      targetNode.parentNode.classList.remove('current');

      left += rectWidth;
    }

    // adjust extremely satisfied label position
    const descNodes = this.sliderNode.querySelectorAll('g.rating .description');
    let descX = RAIL_LEFT;
    descNodes[0].setAttribute('x', descX);

    descX = Math.round(railWidth - descNodes[1].getBBox().width + 2);
    descNodes[1].setAttribute('x', descX);

    return [infoRatingRects, railWidth];
  }

  calcDefaultFocusRect() {
    return {
      x: 2,
      y: 2,
      width: this.railWidth + SELECTED_SIZE,
      height: RAIL_TOP + RAIL_HEIGHT + SELECTED_SIZE,
      rx: SELECTED_SIZE,
    };
  }

  resetRects() {
    for (let i = 0; i < this.targetRects.length; i += 1) {
      const targetNode = this.targetRects[i];
      const targetInfo = this.targetInfo[i];
      const labelNode = this.labelTexts[i];

      targetNode.setAttribute('x', targetInfo.x);
      targetNode.setAttribute('y', targetInfo.y);
      targetNode.setAttribute('width', targetInfo.width);
      targetNode.setAttribute('height', targetInfo.height);
      targetNode.removeAttribute('rx');

      this.setLabelPosition(labelNode, targetInfo.x, targetInfo.width);

      targetNode.parentNode.classList.remove('current');
    }
  }

  setSelectedRatingRect(value) {
    let labelNode, targetNode, targetInfo;

    const leftValue = value - 1;
    const rightValue = value + 1;

    if (value > 0) {
      targetNode = this.targetRects[value - 1];
      targetInfo = this.targetInfo[value - 1];
      labelNode = this.labelTexts[value - 1];

      targetNode.parentNode.classList.add('current');

      const rectWidth = targetInfo.width + 2 * SELECTED_SIZE;
      const x = targetInfo.x - SELECTED_SIZE;

      targetNode.setAttribute('x', x);
      targetNode.setAttribute('y', targetInfo.y - SELECTED_SIZE);
      targetNode.setAttribute('width', rectWidth);
      targetNode.setAttribute('height', targetInfo.height + 2 * SELECTED_SIZE);
      targetNode.setAttribute('rx', SELECTED_SIZE);

      this.setLabelPosition(labelNode, x, rectWidth, '120%');
    }

    if (leftValue > 0) {
      targetNode = this.targetRects[leftValue - 1];
      targetInfo = this.targetInfo[leftValue - 1];

      targetNode.setAttribute('width', targetInfo.width - SELECTED_SIZE);
    }

    if (rightValue <= this.valueMax && value > 0) {
      targetNode = this.targetRects[rightValue - 1];
      targetInfo = this.targetInfo[rightValue - 1];

      targetNode.setAttribute('x', targetInfo.x + SELECTED_SIZE);
      targetNode.setAttribute('width', targetInfo.width - SELECTED_SIZE);
    }
  }

  setLabelPosition(labelNode, x, rectWidth, fontSize = '95%') {
    labelNode.setAttribute('style', `font-size: ${fontSize}`);

    const labelWidth = Math.round(labelNode.getBBox().width);
    const labelHeight = Math.round(labelNode.getBBox().height);

    labelNode.setAttribute(
      'x',
      2 + x + Math.round((rectWidth - labelWidth) / 2)
    );
    labelNode.setAttribute(
      'y',
      -1 +
        RAIL_TOP +
        RAIL_HEIGHT -
        Math.round((RAIL_HEIGHT - labelHeight + 4) / 2)
    );
  }

  setFocusRing(value) {
    const size = 2 * SELECTED_SIZE;

    if (value > 0 && value <= this.valueMax) {
      const targetInfo = this.targetInfo[value - 1];

      this.focusRect.setAttribute('x', targetInfo.x - size);
      this.focusRect.setAttribute('y', targetInfo.y - size);
      this.focusRect.setAttribute('width', targetInfo.width + 2 * size);
      this.focusRect.setAttribute('height', targetInfo.height + 2 * size);
      this.focusRect.setAttribute('rx', size);
    } else {
      // Set ring around entire control

      this.focusRect.setAttribute('x', this.infoDefaultFocusRect.x);
      this.focusRect.setAttribute('y', this.infoDefaultFocusRect.y);
      this.focusRect.setAttribute('width', this.infoDefaultFocusRect.width);
      this.focusRect.setAttribute('height', this.infoDefaultFocusRect.height);
      this.focusRect.setAttribute('rx', SELECTED_SIZE);
    }
  }

  moveSliderTo(value) {
    value = Math.min(Math.max(value, this.valueMin + 1), this.valueMax);
    this.sliderNode.setAttribute('aria-valuenow', value);
    this.sliderNode.setAttribute('aria-valuetext', this.getValueText(value));

    this.resetRects();
    this.setSelectedRatingRect(value);
    this.setFocusRing(value);
  }

  onSliderKeydown(event) {
    let flag = false;
    let value = this.getValue();

    switch (event.key) {
      case 'ArrowLeft':
      case 'ArrowDown':
        this.moveSliderTo(value - 1);
        flag = true;
        break;

      case 'ArrowRight':
      case 'ArrowUp':
        this.moveSliderTo(value + 1);
        flag = true;
        break;

      case 'PageDown':
        this.moveSliderTo(value - 2);
        flag = true;
        break;

      case 'PageUp':
        this.moveSliderTo(value + 2);
        flag = true;
        break;

      case 'Home':
        this.moveSliderTo(this.valueMin + 1);
        flag = true;
        break;

      case 'End':
        this.moveSliderTo(this.valueMax);
        flag = true;
        break;

      default:
        break;
    }

    if (flag) {
      event.preventDefault();
      event.stopPropagation();
    }
  }

  addTotalRectsToRatingLabel() {
    let valuetext = this.getValueTextWithMax(this.getValue());
    this.sliderNode.setAttribute('aria-valuetext', valuetext);
  }

  onTargetClick(event) {
    this.moveSliderTo(
      event.currentTarget.parentNode.getAttribute('data-value')
    );

    event.preventDefault();
    event.stopPropagation();

    // Set focus to the clicked handle
    this.sliderNode.focus();
  }

  onSliderPointerDown(event) {
    if (!this.isMoving) {
      this.isMoving = true;
    }
    event.preventDefault();
    event.stopPropagation();
  }

  onPointerMove(event) {
    if (this.isMoving) {
      this.moveSliderTo(
        event.currentTarget.parentNode.getAttribute('data-value')
      );
      event.preventDefault();
      event.stopPropagation();
    }
  }

  onPointerUp() {
    if (this.isMoving) {
      this.isMoving = false;
      // Set focus to the clicked handle
      this.sliderNode.focus();
    }
  }

  onResize() {
    [this.targetInfo, this.railWidth] = this.calcRatingRects();
    this.infoDefaultFocusRect = this.calcDefaultFocusRect();
    this.setSelectedRatingRect(this.getValue());
    this.setFocusRing(this.getValue());
  }
}

// Initialize RatingSliders on the page
window.addEventListener('load', function () {
  var sliders = document.querySelectorAll('.rating-slider');
  for (let i = 0; i < sliders.length; i++) {
    new RatingSlider(sliders[i]);
  }
});

  // Drag and drop support for custom sliders
  let draggingSlider = null;
  let draggingId = null;

  function customSliderStartDrag(event, slider, id) {
    if (event.button !== 0) return; // Only left mouse button
    draggingSlider = slider;
    draggingId = id;
    document.addEventListener('mousemove', customSliderDragMove);
    document.addEventListener('mouseup', customSliderStopDrag);
    customSliderDragMove(event); // Set value immediately
    event.preventDefault();
  }

  function customSliderDragMove(event) {
    if (!draggingSlider) return;
    const rect = draggingSlider.getBoundingClientRect();
    let x = event.clientX - rect.left;
    x = Math.max(0, Math.min(rect.width, x));
    let value = Math.round((x / rect.width) * 100);
    value = Math.max(0, Math.min(100, value));
    setCustomSliderValue(draggingSlider, value, draggingId);
  }

  function customSliderStopDrag(event) {
    draggingSlider = null;
    draggingId = null;
    document.removeEventListener('mousemove', customSliderDragMove);
    document.removeEventListener('mouseup', customSliderStopDrag);
  }

  // ...existing code for customSliderKeydown, customSliderClick, setCustomSliderValue, etc...
  function customSliderKeydown(event, slider, id) {
    let value = parseInt(slider.getAttribute('data-value') || 50, 10);
    if (event.key === 'ArrowLeft' || event.key === 'ArrowDown') {
      value = Math.max(0, value - 1);
    } else if (event.key === 'ArrowRight' || event.key === 'ArrowUp') {
      value = Math.min(100, value + 1);
    } else {
      return;
    }
    setCustomSliderValue(slider, value, id);
    event.preventDefault();
  }
  function customSliderClick(event, slider, id) {
    const rect = slider.getBoundingClientRect();
    const x = event.clientX - rect.left;
    let value = Math.round((x / rect.width) * 100);
    value = Math.max(0, Math.min(100, value));
    setCustomSliderValue(slider, value, id);
  }
  function setCustomSliderValue(slider, value, id) {
    const thumb = slider.querySelector('div');
    thumb.style.left = `calc(${value}% - 12px)`;
    slider.setAttribute('data-value', value);
    if (id === 'custom-slider1') {
      document.getElementById('custom-slider1-value').textContent = value;
    } else if (id === 'custom-slider2') {
      document.getElementById('custom-slider2-value').textContent = value;
      slider.setAttribute('aria-valuenow', value);
    }
  }
  // Inicialització sliders personalitzats
  document.addEventListener('DOMContentLoaded', function () {
    setCustomSliderValue(document.getElementById('custom-slider1'), 50, 'custom-slider1');
    setCustomSliderValue(document.getElementById('custom-slider2'), 50, 'custom-slider2');
  });

  // ...existing code for syncSliderInput, syncInputSlider, RatingSlider...
</script>
<!-- ...existing code... -->